{"version":3,"file":"MediaManagement.js","sources":["../../src/pages/admin/MediaManagement.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport { db } from '@/lib/db';\r\nimport { Button } from '@/components/ui/button';\r\nimport { Input } from '@/components/ui/input';\r\nimport { Textarea } from '@/components/ui/textarea';\r\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\r\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\r\nimport { Plus, Pencil, Trash2, Image as ImageIcon, Video } from 'lucide-react';\r\nimport { useToast } from '@/hooks/use-toast';\r\nimport { Media } from '@/types/models';\r\n\r\nconst MediaManagement = () => {\r\n  const { toast } = useToast();\r\n  const [media, setMedia] = useState<Media[]>([]);\r\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\r\n  const [editingMedia, setEditingMedia] = useState<Media | null>(null);\r\n  const [formData, setFormData] = useState({\r\n    title: '',\r\n    description: '',\r\n    fileUrl: '',\r\n    type: 'image' as 'image' | 'video',\r\n    tags: [] as string[]\r\n  });\r\n\r\n  useEffect(() => {\r\n    loadMedia();\r\n  }, []);\r\n\r\n  const loadMedia = async () => {\r\n    try {\r\n      const data = await db.getMedia();\r\n      setMedia(data);\r\n    } catch (error) {\r\n      console.error('Ошибка при загрузке медиа:', error);\r\n      setMedia([]);\r\n      toast({\r\n        variant: \"destructive\",\r\n        title: \"Ошибка\",\r\n        description: \"Ошибка при загрузке медиа файлов\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleSubmit = async (e: React.FormEvent) => {\r\n    e.preventDefault();\r\n    try {\r\n      if (editingMedia) {\r\n        await db.updateMedia(editingMedia.id, formData);\r\n        toast({\r\n          title: \"Успех\",\r\n          description: \"Медиа файл обновлен\"\r\n        });\r\n      } else {\r\n        await db.createMedia({\r\n          ...formData,\r\n          date: new Date().toISOString()\r\n        });\r\n        toast({\r\n          title: \"Успех\",\r\n          description: \"Медиа файл создан\"\r\n        });\r\n      }\r\n      setIsDialogOpen(false);\r\n      loadMedia();\r\n      resetForm();\r\n    } catch (error) {\r\n      toast({\r\n        variant: \"destructive\",\r\n        title: \"Ошибка\",\r\n        description: \"Произошла ошибка\"\r\n      });\r\n    }\r\n  };\r\n\r\n  const handleEdit = (mediaItem: Media) => {\r\n    setEditingMedia(mediaItem);\r\n    setFormData({\r\n      title: mediaItem.title,\r\n      description: mediaItem.description,\r\n      fileUrl: mediaItem.fileUrl,\r\n      type: mediaItem.type,\r\n      tags: mediaItem.tags\r\n    });\r\n    setIsDialogOpen(true);\r\n  };\r\n\r\n  const handleDelete = async (id: string) => {\r\n    if (window.confirm('Вы уверены, что хотите удалить этот медиа файл?')) {\r\n      try {\r\n        await db.deleteMedia(id);\r\n        toast({\r\n          title: \"Успех\",\r\n          description: \"Медиа файл удален\"\r\n        });\r\n        loadMedia();\r\n      } catch (error) {\r\n        toast({\r\n          variant: \"destructive\",\r\n          title: \"Ошибка\",\r\n          description: \"Ошибка при удалении медиа файла\"\r\n        });\r\n      }\r\n    }\r\n  };\r\n\r\n  const resetForm = () => {\r\n    setEditingMedia(null);\r\n    setFormData({\r\n      title: '',\r\n      description: '',\r\n      fileUrl: '',\r\n      type: 'image',\r\n      tags: []\r\n    });\r\n  };\r\n\r\n  return (\r\n    <div className=\"space-y-6\">\r\n      <div className=\"flex justify-between items-center\">\r\n        <h1 className=\"text-2xl font-bold\">Управление медиа</h1>\r\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\r\n          <DialogTrigger asChild>\r\n            <Button onClick={() => resetForm()}>\r\n              <Plus className=\"mr-2 h-4 w-4\" />\r\n              Добавить медиа\r\n            </Button>\r\n          </DialogTrigger>\r\n          <DialogContent className=\"max-w-2xl\">\r\n            <DialogHeader>\r\n              <DialogTitle>{editingMedia ? 'Редактировать медиа' : 'Новый медиа файл'}</DialogTitle>\r\n            </DialogHeader>\r\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\r\n              <div>\r\n                <label className=\"text-sm font-medium\">Название</label>\r\n                <Input\r\n                  value={formData.title}\r\n                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}\r\n                  required\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-sm font-medium\">Описание</label>\r\n                <Textarea\r\n                  value={formData.description}\r\n                  onChange={(e) => setFormData({ ...formData, description: e.target.value })}\r\n                  className=\"min-h-[100px]\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-sm font-medium\">URL файла</label>\r\n                <Input\r\n                  value={formData.fileUrl}\r\n                  onChange={(e) => setFormData({ ...formData, fileUrl: e.target.value })}\r\n                  required\r\n                  placeholder=\"https://example.com/file.jpg\"\r\n                />\r\n              </div>\r\n\r\n              <div>\r\n                <label className=\"text-sm font-medium\">Тип</label>\r\n                <select\r\n                  value={formData.type}\r\n                  onChange={(e) => setFormData({ ...formData, type: e.target.value as 'image' | 'video' })}\r\n                  className=\"w-full px-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500\"\r\n                >\r\n                  <option value=\"image\">Изображение</option>\r\n                  <option value=\"video\">Видео</option>\r\n                </select>\r\n              </div>\r\n\r\n              <div className=\"flex justify-end space-x-2\">\r\n                <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\r\n                  Отмена\r\n                </Button>\r\n                <Button type=\"submit\">\r\n                  {editingMedia ? 'Сохранить' : 'Создать'}\r\n                </Button>\r\n              </div>\r\n            </form>\r\n          </DialogContent>\r\n        </Dialog>\r\n      </div>\r\n\r\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\r\n        {media.map((mediaItem) => (\r\n          <Card key={mediaItem.id}>\r\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\r\n              <CardTitle className=\"text-lg font-medium line-clamp-2\">\r\n                {mediaItem.title}\r\n              </CardTitle>\r\n              <div className=\"flex space-x-2\">\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => handleEdit(mediaItem)}\r\n                >\r\n                  <Pencil className=\"h-4 w-4\" />\r\n                </Button>\r\n                <Button\r\n                  variant=\"outline\"\r\n                  size=\"sm\"\r\n                  onClick={() => handleDelete(mediaItem.id)}\r\n                >\r\n                  <Trash2 className=\"h-4 w-4\" />\r\n                </Button>\r\n              </div>\r\n            </CardHeader>\r\n            <CardContent>\r\n              <div className=\"flex items-center mb-2\">\r\n                {mediaItem.type === 'image' ? (\r\n                  <ImageIcon className=\"h-4 w-4 mr-2 text-blue-500\" />\r\n                ) : (\r\n                  <Video className=\"h-4 w-4 mr-2 text-red-500\" />\r\n                )}\r\n                <span className=\"text-sm text-gray-500 capitalize\">{mediaItem.type}</span>\r\n              </div>\r\n              <p className=\"text-sm text-gray-600 line-clamp-3 mb-2\">\r\n                {mediaItem.description}\r\n              </p>\r\n              <div className=\"text-xs text-gray-400\">\r\n                {new Date(mediaItem.date).toLocaleDateString()}\r\n              </div>\r\n            </CardContent>\r\n          </Card>\r\n        ))}\r\n      </div>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default MediaManagement; "],"names":["MediaManagement","toast","useToast","media","setMedia","useState","isDialogOpen","setIsDialogOpen","editingMedia","setEditingMedia","formData","setFormData","useEffect","loadMedia","__async","data","db","error","handleSubmit","e","__spreadProps","__spreadValues","resetForm","handleEdit","mediaItem","handleDelete","id","jsxs","jsx","Dialog","DialogTrigger","Button","Plus","DialogContent","DialogHeader","DialogTitle","Input","Textarea","Card","CardHeader","CardTitle","Pencil","Trash2","CardContent","ImageIcon","Video"],"mappings":"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"}