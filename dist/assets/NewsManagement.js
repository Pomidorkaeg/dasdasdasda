var S=Object.defineProperty,T=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var N=Object.getOwnPropertySymbols;var k=Object.prototype.hasOwnProperty,A=Object.prototype.propertyIsEnumerable;var y=(a,i,s)=>i in a?S(a,i,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[i]=s,d=(a,i)=>{for(var s in i||(i={}))k.call(i,s)&&y(a,s,i[s]);if(N)for(var s of N(i))A.call(i,s)&&y(a,s,i[s]);return a},m=(a,i)=>T(a,E(i));var j=(a,i,s)=>new Promise((g,n)=>{var o=l=>{try{r(s.next(l))}catch(c){n(c)}},u=l=>{try{r(s.throw(l))}catch(c){n(c)}},r=l=>l.done?g(l.value):Promise.resolve(l.value).then(o,u);r((s=s.apply(a,i)).next())});import{j as e,t as q,u as O,v as z}from"./ui-vendor.js";import{r as x}from"./react-vendor.js";import{n as p}from"./api2.js";import{B as h}from"./button.js";import{I as f}from"./input.js";import{T as B}from"./textarea.js";import{C as F,a as H,b as L,c as P}from"./card.js";import{D as R,a as M,b as U,c as G,d as J}from"./dialog.js";import{u as K}from"./index.js";import"./query.js";const se=()=>{const{toast:a}=K(),[i,s]=x.useState([]),[g,n]=x.useState(!1),[o,u]=x.useState(null),[r,l]=x.useState({title:"",content:"",image:"",author:""});x.useEffect(()=>{c()},[]);const c=()=>j(void 0,null,function*(){try{const t=yield p.getAll();t&&Array.isArray(t)?s(t):(s([]),console.error("Полученные данные не являются массивом:",t))}catch(t){console.error("Ошибка при загрузке новостей:",t),s([]),a({variant:"destructive",title:"Ошибка",description:"Ошибка при загрузке новостей"})}}),b=t=>j(void 0,null,function*(){t.preventDefault();try{o?(yield p.update(parseInt(o.id),r),a({title:"Успех",description:"Новость обновлена"})):(yield p.create(r),a({title:"Успех",description:"Новость создана"})),n(!1),c(),v()}catch(w){a({variant:"destructive",title:"Ошибка",description:"Произошла ошибка"})}}),C=t=>{u(t),l({title:t.title,content:t.content,image:t.image||"",author:t.author||""}),n(!0)},D=t=>j(void 0,null,function*(){if(window.confirm("Вы уверены, что хотите удалить эту новость?"))try{yield p.delete(parseInt(t)),a({title:"Успех",description:"Новость удалена"}),c()}catch(w){a({variant:"destructive",title:"Ошибка",description:"Ошибка при удалении новости"})}}),v=()=>{u(null),l({title:"",content:"",image:"",author:""})};return e.jsxs("div",{className:"space-y-6",children:[e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("h1",{className:"text-2xl font-bold",children:"Управление новостями"}),e.jsxs(R,{open:g,onOpenChange:n,children:[e.jsx(M,{asChild:!0,children:e.jsxs(h,{onClick:()=>v(),children:[e.jsx(q,{className:"mr-2 h-4 w-4"}),"Добавить новость"]})}),e.jsxs(U,{className:"max-w-2xl",children:[e.jsx(G,{children:e.jsx(J,{children:o?"Редактировать новость":"Новая новость"})}),e.jsxs("form",{onSubmit:b,className:"space-y-4",children:[e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Заголовок"}),e.jsx(f,{value:r.title,onChange:t=>l(m(d({},r),{title:t.target.value})),required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Содержание"}),e.jsx(B,{value:r.content,onChange:t=>l(m(d({},r),{content:t.target.value})),required:!0,className:"min-h-[200px]"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"URL изображения"}),e.jsx(f,{value:r.image,onChange:t=>l(m(d({},r),{image:t.target.value})),placeholder:"https://example.com/image.jpg"})]}),e.jsxs("div",{children:[e.jsx("label",{className:"text-sm font-medium",children:"Автор"}),e.jsx(f,{value:r.author,onChange:t=>l(m(d({},r),{author:t.target.value})),required:!0})]}),e.jsxs("div",{className:"flex justify-end space-x-2",children:[e.jsx(h,{type:"button",variant:"outline",onClick:()=>n(!1),children:"Отмена"}),e.jsx(h,{type:"submit",children:o?"Сохранить":"Создать"})]})]})]})]})]}),e.jsx("div",{className:"grid gap-4 md:grid-cols-2 lg:grid-cols-3",children:i.map(t=>e.jsxs(F,{children:[e.jsxs(H,{className:"flex flex-row items-center justify-between space-y-0 pb-2",children:[e.jsx(L,{className:"text-lg font-medium line-clamp-2",children:t.title}),e.jsxs("div",{className:"flex space-x-2",children:[e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>C(t),children:e.jsx(O,{className:"h-4 w-4"})}),e.jsx(h,{variant:"ghost",size:"icon",onClick:()=>D(t.id),children:e.jsx(z,{className:"h-4 w-4"})})]})]}),e.jsx(P,{children:e.jsxs("div",{className:"space-y-2",children:[t.image&&e.jsx("img",{src:t.image,alt:t.title,className:"w-full h-48 object-cover rounded-md mb-2"}),e.jsx("p",{className:"text-sm line-clamp-3",children:t.content}),e.jsxs("div",{className:"flex justify-between items-center text-sm text-gray-500",children:[e.jsx("span",{children:t.author}),e.jsx("span",{children:new Date(t.date).toLocaleDateString()})]})]})})]},t.id))})]})};export{se as default};
//# sourceMappingURL=NewsManagement.js.map
