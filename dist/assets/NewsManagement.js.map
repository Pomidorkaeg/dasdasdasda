{"version":3,"file":"NewsManagement.js","sources":["../../src/pages/admin/NewsManagement.tsx"],"sourcesContent":["import React, { useState, useEffect } from 'react';\nimport { newsApi } from '@/api/api';\nimport { Button } from '@/components/ui/button';\nimport { Input } from '@/components/ui/input';\nimport { Textarea } from '@/components/ui/textarea';\nimport { Card, CardContent, CardHeader, CardTitle } from '@/components/ui/card';\nimport { Dialog, DialogContent, DialogHeader, DialogTitle, DialogTrigger } from '@/components/ui/dialog';\nimport { Plus, Pencil, Trash2 } from 'lucide-react';\nimport { useToast } from '@/hooks/use-toast';\n\ninterface News {\n  id: string;\n  title: string;\n  content: string;\n  image: string | null;\n  author: string | null;\n  date: Date;\n  tags: string[];\n  category: string;\n}\n\nconst NewsManagement = () => {\n  const { toast } = useToast();\n  const [news, setNews] = useState<News[]>([]);\n  const [isDialogOpen, setIsDialogOpen] = useState(false);\n  const [editingNews, setEditingNews] = useState<News | null>(null);\n  const [formData, setFormData] = useState({\n    title: '',\n    content: '',\n    image: '',\n    author: ''\n  });\n\n  useEffect(() => {\n    loadNews();\n  }, []);\n\n  const loadNews = async () => {\n    try {\n      const data = await newsApi.getAll();\n      if (data && Array.isArray(data)) {\n        setNews(data);\n      } else {\n        setNews([]);\n        console.error('Полученные данные не являются массивом:', data);\n      }\n    } catch (error) {\n      console.error('Ошибка при загрузке новостей:', error);\n      setNews([]);\n      toast({\n        variant: \"destructive\",\n        title: \"Ошибка\",\n        description: \"Ошибка при загрузке новостей\"\n      });\n    }\n  };\n\n  const handleSubmit = async (e: React.FormEvent) => {\n    e.preventDefault();\n    try {\n      if (editingNews) {\n        await newsApi.update(parseInt(editingNews.id), formData);\n        toast({\n          title: \"Успех\",\n          description: \"Новость обновлена\"\n        });\n      } else {\n        await newsApi.create(formData);\n        toast({\n          title: \"Успех\",\n          description: \"Новость создана\"\n        });\n      }\n      setIsDialogOpen(false);\n      loadNews();\n      resetForm();\n    } catch (error) {\n      toast({\n        variant: \"destructive\",\n        title: \"Ошибка\",\n        description: \"Произошла ошибка\"\n      });\n    }\n  };\n\n  const handleEdit = (newsItem: News) => {\n    setEditingNews(newsItem);\n    setFormData({\n      title: newsItem.title,\n      content: newsItem.content,\n      image: newsItem.image || '',\n      author: newsItem.author || ''\n    });\n    setIsDialogOpen(true);\n  };\n\n  const handleDelete = async (id: string) => {\n    if (window.confirm('Вы уверены, что хотите удалить эту новость?')) {\n      try {\n        await newsApi.delete(parseInt(id));\n        toast({\n          title: \"Успех\",\n          description: \"Новость удалена\"\n        });\n        loadNews();\n      } catch (error) {\n        toast({\n          variant: \"destructive\",\n          title: \"Ошибка\",\n          description: \"Ошибка при удалении новости\"\n        });\n      }\n    }\n  };\n\n  const resetForm = () => {\n    setEditingNews(null);\n    setFormData({\n      title: '',\n      content: '',\n      image: '',\n      author: ''\n    });\n  };\n\n  return (\n    <div className=\"space-y-6\">\n      <div className=\"flex justify-between items-center\">\n        <h1 className=\"text-2xl font-bold\">Управление новостями</h1>\n        <Dialog open={isDialogOpen} onOpenChange={setIsDialogOpen}>\n          <DialogTrigger asChild>\n            <Button onClick={() => resetForm()}>\n              <Plus className=\"mr-2 h-4 w-4\" />\n              Добавить новость\n            </Button>\n          </DialogTrigger>\n          <DialogContent className=\"max-w-2xl\">\n            <DialogHeader>\n              <DialogTitle>{editingNews ? 'Редактировать новость' : 'Новая новость'}</DialogTitle>\n            </DialogHeader>\n            <form onSubmit={handleSubmit} className=\"space-y-4\">\n              <div>\n                <label className=\"text-sm font-medium\">Заголовок</label>\n                <Input\n                  value={formData.title}\n                  onChange={(e) => setFormData({ ...formData, title: e.target.value })}\n                  required\n                />\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium\">Содержание</label>\n                <Textarea\n                  value={formData.content}\n                  onChange={(e) => setFormData({ ...formData, content: e.target.value })}\n                  required\n                  className=\"min-h-[200px]\"\n                />\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium\">URL изображения</label>\n                <Input\n                  value={formData.image}\n                  onChange={(e) => setFormData({ ...formData, image: e.target.value })}\n                  placeholder=\"https://example.com/image.jpg\"\n                />\n              </div>\n\n              <div>\n                <label className=\"text-sm font-medium\">Автор</label>\n                <Input\n                  value={formData.author}\n                  onChange={(e) => setFormData({ ...formData, author: e.target.value })}\n                  required\n                />\n              </div>\n\n              <div className=\"flex justify-end space-x-2\">\n                <Button type=\"button\" variant=\"outline\" onClick={() => setIsDialogOpen(false)}>\n                  Отмена\n                </Button>\n                <Button type=\"submit\">\n                  {editingNews ? 'Сохранить' : 'Создать'}\n                </Button>\n              </div>\n            </form>\n          </DialogContent>\n        </Dialog>\n      </div>\n\n      <div className=\"grid gap-4 md:grid-cols-2 lg:grid-cols-3\">\n        {news.map((newsItem) => (\n          <Card key={newsItem.id}>\n            <CardHeader className=\"flex flex-row items-center justify-between space-y-0 pb-2\">\n              <CardTitle className=\"text-lg font-medium line-clamp-2\">\n                {newsItem.title}\n              </CardTitle>\n              <div className=\"flex space-x-2\">\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => handleEdit(newsItem)}\n                >\n                  <Pencil className=\"h-4 w-4\" />\n                </Button>\n                <Button\n                  variant=\"ghost\"\n                  size=\"icon\"\n                  onClick={() => handleDelete(newsItem.id)}\n                >\n                  <Trash2 className=\"h-4 w-4\" />\n                </Button>\n              </div>\n            </CardHeader>\n            <CardContent>\n              <div className=\"space-y-2\">\n                {newsItem.image && (\n                  <img\n                    src={newsItem.image}\n                    alt={newsItem.title}\n                    className=\"w-full h-48 object-cover rounded-md mb-2\"\n                  />\n                )}\n                <p className=\"text-sm line-clamp-3\">{newsItem.content}</p>\n                <div className=\"flex justify-between items-center text-sm text-gray-500\">\n                  <span>{newsItem.author}</span>\n                  <span>{new Date(newsItem.date).toLocaleDateString()}</span>\n                </div>\n              </div>\n            </CardContent>\n          </Card>\n        ))}\n      </div>\n    </div>\n  );\n};\n\nexport default NewsManagement; "],"names":["NewsManagement","toast","useToast","news","setNews","useState","isDialogOpen","setIsDialogOpen","editingNews","setEditingNews","formData","setFormData","useEffect","loadNews","__async","data","newsApi","error","handleSubmit","e","resetForm","handleEdit","newsItem","handleDelete","id","jsxs","jsx","Dialog","DialogTrigger","Button","Plus","DialogContent","DialogHeader","DialogTitle","Input","__spreadProps","__spreadValues","Textarea","Card","CardHeader","CardTitle","Pencil","Trash2","CardContent"],"mappings":"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"}